China and Britain reach agreement on Chinese troops in Hong Kong, but disagreement looms over residency rights after handover